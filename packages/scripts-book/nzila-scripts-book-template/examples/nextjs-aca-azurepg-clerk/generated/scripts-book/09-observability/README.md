<!-- AUTO-GENERATED by nzila-scripts-book-template — do not edit directly -->

# Chapter 09 — Observability

This chapter covers logging, monitoring, alerting, and health checks for
**CourtLens**.

## Pillars

| Pillar      | Tool / Service        | Purpose                     |
| ----------- | --------------------- | --------------------------- |
| Logging     | Structured JSON logs  | Request traces, errors      |
| Metrics     | OpenTelemetry         | Latency, throughput, errors |
| Tracing     | OpenTelemetry / Sentry | Distributed request tracing |
| Alerting    | azure_container_apps alerts | Threshold-based notifications |

## Logging

- All application logs are emitted as structured JSON to `stdout`.
- Each log entry includes `requestId`, `orgId`, `level`, and `timestamp`.
- Log levels: `debug`, `info`, `warn`, `error`, `fatal`.
- In production, the minimum level is `info`.

## Health checks

The `/api/health` endpoint returns:

```json
{
  "status": "healthy",
  "version": "{{GIT_SHA}}",
  "checks": {
    "database": "ok",
    "cache": "ok"
  }
}
```

Load balancers and uptime monitors poll this endpoint every 30 seconds.

## Metrics

OpenTelemetry is configured in `instrumentation.ts`. Key metrics:

- `http.server.duration` — Request latency histogram.
- `http.server.request.count` — Request throughput counter.
- `db.client.duration` — Database query latency.
- `errors.unhandled` — Unhandled exception counter.

## Alerting rules

| Alert                        | Condition                | Channel |
| ---------------------------- | ------------------------ | ------- |
| High error rate              | > 1 % 5xx in 5 min      | Slack   |
| Latency spike                | p99 > 3 s for 5 min     | Slack   |
| Database connection failures | > 5 failures in 1 min   | PagerDuty |
| Health check down            | 3 consecutive failures  | PagerDuty |

## Dashboards

Dashboards are defined as code in `monitoring/dashboards/` and deployed
alongside the application infrastructure.
