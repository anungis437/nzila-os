<!-- AUTO-GENERATED by nzila-scripts-book-template — do not edit directly -->

# Chapter 07 — CI/CD (azure_container_apps)

This chapter documents the continuous integration and deployment pipelines for
**CourtLens**.

## Pipeline overview

```
Push / PR
  └─ CI ─────────────────────────────────────┐
       ├── Lint + Typecheck                  │
       ├── Unit + Integration tests          │
       ├── E2E tests (Playwright)            │
       ├── Build Docker image                │
       └── Security scan (CodeQL / Trivy)    │
                                             ▼
  └─ CD (on main merge) ────────────────────┐
       ├── Push image → courtlens-web       │
       ├── Deploy to staging (https://courtlens-staging.azurecontainerapps.io)│
       ├── Smoke tests against staging       │
       └── Promote to prod (https://courtlens.azurecontainerapps.io)
```

## Authentication

CI authenticates to azure_container_apps using **OIDC federation** — no
long-lived credentials are stored in the repository. The GitHub Actions
workflow exchanges a short-lived OIDC token for cloud credentials at runtime.

## Environments

| Environment | URL                  | Trigger                |
| ----------- | -------------------- | ---------------------- |
| Staging     | https://courtlens-staging.azurecontainerapps.io      | Push to `main`         |
| Production  | https://courtlens.azurecontainerapps.io   | Manual approval / tag  |

## Image registry

Docker images are pushed to **courtlens-web**. Images are tagged with the
Git SHA and `latest` for the most recent successful build.

## Deployment strategy

- **Staging** — Automatic deploy on every merge to `main`.
- **Production** — Blue-green deployment triggered by a manual workflow dispatch or a Git tag matching `v*`.

## Rollback

To roll back production:

1. Identify the last known-good image tag in courtlens-web.
2. Re-run the deploy workflow with that tag.
3. Verify health checks at https://courtlens.azurecontainerapps.io/api/health.

## Secrets management

All secrets are stored in the GitHub repository environment secrets and
injected at deploy time. Never commit secrets to source control.
