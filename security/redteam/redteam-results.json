{"numTotalTestSuites":24,"numPassedTestSuites":24,"numFailedTestSuites":0,"numPendingTestSuites":0,"numTotalTests":61,"numPassedTests":61,"numFailedTests":0,"numPendingTests":0,"numTodoTests":0,"snapshot":{"added":0,"failure":false,"filesAdded":0,"filesRemoved":0,"filesRemovedList":[],"filesUnmatched":0,"filesUpdated":0,"matched":0,"total":0,"unchecked":0,"uncheckedKeysByFile":[],"unmatched":0,"updated":0,"didUpdate":false},"startTime":1772295415481,"success":true,"testResults":[{"assertionResults":[{"ancestorTitles":["RED-TEAM-ABR-001 — Metadata inference attack resistance"],"fullName":"RED-TEAM-ABR-001 — Metadata inference attack resistance encrypted identity data leaks no plaintext","status":"passed","title":"encrypted identity data leaks no plaintext","duration":1.90270000000001,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-ABR-001 — Metadata inference attack resistance"],"fullName":"RED-TEAM-ABR-001 — Metadata inference attack resistance different encryptions of the same data produce different ciphertext","status":"passed","title":"different encryptions of the same data produce different ciphertext","duration":0.8862000000000023,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-ABR-001 — Metadata inference attack resistance"],"fullName":"RED-TEAM-ABR-001 — Metadata inference attack resistance decryption with wrong key fails","status":"passed","title":"decryption with wrong key fails","duration":0.9841999999999871,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-ABR-002 — Unauthorized identity access blocked"],"fullName":"RED-TEAM-ABR-002 — Unauthorized identity access blocked user without identity-access grant is denied","status":"passed","title":"user without identity-access grant is denied","duration":0.25919999999999277,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-ABR-002 — Unauthorized identity access blocked"],"fullName":"RED-TEAM-ABR-002 — Unauthorized identity access blocked expired grant is rejected","status":"passed","title":"expired grant is rejected","duration":0.2091000000000065,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-ABR-002 — Unauthorized identity access blocked"],"fullName":"RED-TEAM-ABR-002 — Unauthorized identity access blocked user without metadata role cannot see case metadata","status":"passed","title":"user without metadata role cannot see case metadata","duration":0.1384999999999934,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-ABR-003 — Dual-control self-approval is blocked"],"fullName":"RED-TEAM-ABR-003 — Dual-control self-approval is blocked same-person approval is rejected","status":"passed","title":"same-person approval is rejected","duration":0.22589999999999577,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-ABR-003 — Dual-control self-approval is blocked"],"fullName":"RED-TEAM-ABR-003 — Dual-control self-approval is blocked approval without required role is rejected","status":"passed","title":"approval without required role is rejected","duration":0.13630000000000564,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-ABR-003 — Dual-control self-approval is blocked"],"fullName":"RED-TEAM-ABR-003 — Dual-control self-approval is blocked valid dual-control with different principals succeeds","status":"passed","title":"valid dual-control with different principals succeeds","duration":0.16639999999998167,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-ABR-003 — Dual-control self-approval is blocked"],"fullName":"RED-TEAM-ABR-003 — Dual-control self-approval is blocked missing approval is rejected","status":"passed","title":"missing approval is rejected","duration":0.13120000000000687,"failureMessages":[],"meta":{}}],"startTime":1772295415776,"endTime":1772295415781.2258,"status":"passed","message":"","name":"C:/APPS/nzila-automation/security/redteam/abr-adversarial.test.ts"},{"assertionResults":[{"ancestorTitles":["RED-TEAM-001 — Cross-org data access must be structurally impossible"],"fullName":"RED-TEAM-001 — Cross-org data access must be structurally impossible createScopedDb enforces Org isolation — cannot be constructed without orgId","status":"passed","title":"createScopedDb enforces Org isolation — cannot be constructed without orgId","duration":1.4437000000000069,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-001 — Cross-org data access must be structurally impossible"],"fullName":"RED-TEAM-001 — Cross-org data access must be structurally impossible ScopedDb injects orgId on every SELECT query","status":"passed","title":"ScopedDb injects orgId on every SELECT query","duration":0.43180000000000973,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-001 — Cross-org data access must be structurally impossible"],"fullName":"RED-TEAM-001 — Cross-org data access must be structurally impossible ScopedDb injects orgId on every INSERT","status":"passed","title":"ScopedDb injects orgId on every INSERT","duration":0.3960999999999899,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-001 — Cross-org data access must be structurally impossible"],"fullName":"RED-TEAM-001 — Cross-org data access must be structurally impossible no app code bypasses entity scoping via raw DB imports","status":"passed","title":"no app code bypasses entity scoping via raw DB imports","duration":859.0871,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-002 — Privilege escalation must be blocked"],"fullName":"RED-TEAM-002 — Privilege escalation must be blocked authorize() function validates role hierarchy","status":"passed","title":"authorize() function validates role hierarchy","duration":0.6698999999998705,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-002 — Privilege escalation must be blocked"],"fullName":"RED-TEAM-002 — Privilege escalation must be blocked role definitions use strict hierarchy without bypass flags","status":"passed","title":"role definitions use strict hierarchy without bypass flags","duration":0.6539999999999964,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-002 — Privilege escalation must be blocked"],"fullName":"RED-TEAM-002 — Privilege escalation must be blocked no API route allows unauthenticated access without explicit allowSystem","status":"passed","title":"no API route allows unauthenticated access without explicit allowSystem","duration":0.3105000000000473,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-003 — Write operations without audit must be blocked"],"fullName":"RED-TEAM-003 — Write operations without audit must be blocked withAudit wrapper blocks mutations when audit emission fails","status":"passed","title":"withAudit wrapper blocks mutations when audit emission fails","duration":0.2904999999998381,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-003 — Write operations without audit must be blocked"],"fullName":"RED-TEAM-003 — Write operations without audit must be blocked audit emitter writes to audit_events table with hash chain","status":"passed","title":"audit emitter writes to audit_events table with hash chain","duration":0.302199999999857,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-003 — Write operations without audit must be blocked"],"fullName":"RED-TEAM-003 — Write operations without audit must be blocked default audit emitter never silently drops events","status":"passed","title":"default audit emitter never silently drops events","duration":0.3162999999999556,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-004 — Direct DB import bypass detection"],"fullName":"RED-TEAM-004 — Direct DB import bypass detection no app directory contains raw drizzle instantiation","status":"passed","title":"no app directory contains raw drizzle instantiation","duration":647.8171,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-004 — Direct DB import bypass detection"],"fullName":"RED-TEAM-004 — Direct DB import bypass detection no app directory imports raw pg/postgres drivers","status":"passed","title":"no app directory imports raw pg/postgres drivers","duration":654.1050000000002,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-005 — Replay attack resistance"],"fullName":"RED-TEAM-005 — Replay attack resistance audit events include unique correlationId","status":"passed","title":"audit events include unique correlationId","duration":0.4252999999998792,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-005 — Replay attack resistance"],"fullName":"RED-TEAM-005 — Replay attack resistance audit events include timestamp for ordering","status":"passed","title":"audit events include timestamp for ordering","duration":0.25509999999985666,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-005 — Replay attack resistance"],"fullName":"RED-TEAM-005 — Replay attack resistance hash chain makes replay insertion detectable","status":"passed","title":"hash chain makes replay insertion detectable","duration":39.27019999999993,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-006 — Double-submit prevention"],"fullName":"RED-TEAM-006 — Double-submit prevention governance_actions table has unique constraints preventing duplication","status":"passed","title":"governance_actions table has unique constraints preventing duplication","duration":0.34999999999990905,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-006 — Double-submit prevention"],"fullName":"RED-TEAM-006 — Double-submit prevention automation_commands has unique correlationId","status":"passed","title":"automation_commands has unique correlationId","duration":0.29100000000016735,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-007 — Evidence pack tampering detection"],"fullName":"RED-TEAM-007 — Evidence pack tampering detection tampered artifact hash is detected by verifySeal","status":"passed","title":"tampered artifact hash is detected by verifySeal","duration":5.953099999999722,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-007 — Evidence pack tampering detection"],"fullName":"RED-TEAM-007 — Evidence pack tampering detection removed seal is detected","status":"passed","title":"removed seal is detected","duration":0.26040000000011787,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-008 — Hash chain insertion without valid hash is blocked"],"fullName":"RED-TEAM-008 — Hash chain insertion without valid hash is blocked trigger SQL prevents null hash insertion","status":"passed","title":"trigger SQL prevents null hash insertion","duration":0.43499999999994543,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-008 — Hash chain insertion without valid hash is blocked"],"fullName":"RED-TEAM-008 — Hash chain insertion without valid hash is blocked audit_events schema requires hash NOT NULL","status":"passed","title":"audit_events schema requires hash NOT NULL","duration":0.2928999999999178,"failureMessages":[],"meta":{}}],"startTime":1772295415758,"endTime":1772295417974.293,"status":"passed","message":"","name":"C:/APPS/nzila-automation/security/redteam/adversarial.test.ts"},{"assertionResults":[{"ancestorTitles":["RED-TEAM-009 — Cross-Org read via forged orgId must be structurally impossible"],"fullName":"RED-TEAM-009 — Cross-Org read via forged orgId must be structurally impossible ScopedDb forces org_id filter on every SELECT — no caller override","status":"passed","title":"ScopedDb forces org_id filter on every SELECT — no caller override","duration":1.6163999999999987,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-009 — Cross-Org read via forged orgId must be structurally impossible"],"fullName":"RED-TEAM-009 — Cross-Org read via forged orgId must be structurally impossible ScopedDb validates orgId is a non-empty string at construction","status":"passed","title":"ScopedDb validates orgId is a non-empty string at construction","duration":0.4078999999999837,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-009 — Cross-Org read via forged orgId must be structurally impossible"],"fullName":"RED-TEAM-009 — Cross-Org read via forged orgId must be structurally impossible createScopedDb with object form uses orgId","status":"passed","title":"createScopedDb with object form uses orgId","duration":0.3428000000000111,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-009 — Cross-Org read via forged orgId must be structurally impossible"],"fullName":"RED-TEAM-009 — Cross-Org read via forged orgId must be structurally impossible ReadOnlyScopedDb has no write methods to leak data sideways","status":"passed","title":"ReadOnlyScopedDb has no write methods to leak data sideways","duration":0.48490000000003874,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-010 — Cross-Org write via forged orgId must be blocked"],"fullName":"RED-TEAM-010 — Cross-Org write via forged orgId must be blocked ScopedDb forces org_id into every INSERT record","status":"passed","title":"ScopedDb forces org_id into every INSERT record","duration":0.38900000000001,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-010 — Cross-Org write via forged orgId must be blocked"],"fullName":"RED-TEAM-010 — Cross-Org write via forged orgId must be blocked ScopedDb forces org_id filter on every UPDATE","status":"passed","title":"ScopedDb forces org_id filter on every UPDATE","duration":0.3248999999999569,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-010 — Cross-Org write via forged orgId must be blocked"],"fullName":"RED-TEAM-010 — Cross-Org write via forged orgId must be blocked ScopedDb forces org_id filter on every DELETE","status":"passed","title":"ScopedDb forces org_id filter on every DELETE","duration":0.30049999999999955,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-010 — Cross-Org write via forged orgId must be blocked"],"fullName":"RED-TEAM-010 — Cross-Org write via forged orgId must be blocked AuditedScopedDb wraps ScopedDb — no unscoped write path","status":"passed","title":"AuditedScopedDb wraps ScopedDb — no unscoped write path","duration":0.32749999999998636,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-011 — ReadOnlyScopedDb prevents all writes"],"fullName":"RED-TEAM-011 — ReadOnlyScopedDb prevents all writes ReadOnlyScopedDb interface only exposes select + transaction","status":"passed","title":"ReadOnlyScopedDb interface only exposes select + transaction","duration":0.7016000000000417,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-011 — ReadOnlyScopedDb prevents all writes"],"fullName":"RED-TEAM-011 — ReadOnlyScopedDb prevents all writes ReadOnlyViolationError class exists","status":"passed","title":"ReadOnlyViolationError class exists","duration":0.3865999999999872,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-011 — ReadOnlyScopedDb prevents all writes"],"fullName":"RED-TEAM-011 — ReadOnlyScopedDb prevents all writes ReadOnlyScopedDb is exported from @nzila/db","status":"passed","title":"ReadOnlyScopedDb is exported from @nzila/db","duration":0.3216000000000463,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-012 — Mutation without actorId is blocked"],"fullName":"RED-TEAM-012 — Mutation without actorId is blocked createAuditedScopedDb requires actorId","status":"passed","title":"createAuditedScopedDb requires actorId","duration":0.3036000000000172,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-012 — Mutation without actorId is blocked"],"fullName":"RED-TEAM-012 — Mutation without actorId is blocked withAudit mandatory flag blocks mutation if audit emission fails","status":"passed","title":"withAudit mandatory flag blocks mutation if audit emission fails","duration":0.2676000000000158,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-012 — Mutation without actorId is blocked"],"fullName":"RED-TEAM-012 — Mutation without actorId is blocked no app code calls ScopedDb.insert/update/delete without audit wrapper","status":"passed","title":"no app code calls ScopedDb.insert/update/delete without audit wrapper","duration":0.470799999999997,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-013 — Audit hash chain tampering is detectable"],"fullName":"RED-TEAM-013 — Audit hash chain tampering is detectable audit_events table requires hash NOT NULL","status":"passed","title":"audit_events table requires hash NOT NULL","duration":0.33609999999998763,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-013 — Audit hash chain tampering is detectable"],"fullName":"RED-TEAM-013 — Audit hash chain tampering is detectable hash chain verification exists in os-core","status":"passed","title":"hash chain verification exists in os-core","duration":0.3347999999999729,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-013 — Audit hash chain tampering is detectable"],"fullName":"RED-TEAM-013 — Audit hash chain tampering is detectable hash chain break produces { valid: false, brokenAtIndex }","status":"passed","title":"hash chain break produces { valid: false, brokenAtIndex }","duration":56.542700000000025,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-013 — Audit hash chain tampering is detectable"],"fullName":"RED-TEAM-013 — Audit hash chain tampering is detectable DB immutability triggers exist","status":"passed","title":"DB immutability triggers exist","duration":0.46450000000004366,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-014 — Evidence pack re-seal is blocked"],"fullName":"RED-TEAM-014 — Evidence pack re-seal is blocked lifecycle.ts enforces seal-once via SealOnceViolationError","status":"passed","title":"lifecycle.ts enforces seal-once via SealOnceViolationError","duration":0.4268999999999892,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-014 — Evidence pack re-seal is blocked"],"fullName":"RED-TEAM-014 — Evidence pack re-seal is blocked seal() a second time throws","status":"passed","title":"seal() a second time throws","duration":1.315400000000011,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-015 — Draft evidence packs cannot be persisted"],"fullName":"RED-TEAM-015 — Draft evidence packs cannot be persisted assertSealed throws for draft packs","status":"passed","title":"assertSealed throws for draft packs","duration":0.2290999999999599,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-015 — Draft evidence packs cannot be persisted"],"fullName":"RED-TEAM-015 — Draft evidence packs cannot be persisted isSealedEvidencePack returns false for { status: \"draft\" }","status":"passed","title":"isSealedEvidencePack returns false for { status: \"draft\" }","duration":0.10580000000004475,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-015 — Draft evidence packs cannot be persisted"],"fullName":"RED-TEAM-015 — Draft evidence packs cannot be persisted processEvidencePack inserts with status=sealed in DB","status":"passed","title":"processEvidencePack inserts with status=sealed in DB","duration":0.4046999999999912,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-016 — Forged evidence pack detected by verify-pack"],"fullName":"RED-TEAM-016 — Forged evidence pack detected by verify-pack verify-pack rejects tampered pack (modified orgId)","status":"passed","title":"verify-pack rejects tampered pack (modified orgId)","duration":2.8374999999999773,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-016 — Forged evidence pack detected by verify-pack"],"fullName":"RED-TEAM-016 — Forged evidence pack detected by verify-pack verify-pack rejects pack with injected artifact","status":"passed","title":"verify-pack rejects pack with injected artifact","duration":2.099400000000003,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-017 — Redacted packs must be re-sealed"],"fullName":"RED-TEAM-017 — Redacted packs must be re-sealed redactAndReseal produces a fresh seal","status":"passed","title":"redactAndReseal produces a fresh seal","duration":0.7480999999999653,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-017 — Redacted packs must be re-sealed"],"fullName":"RED-TEAM-017 — Redacted packs must be re-sealed redaction source code calls generateSeal","status":"passed","title":"redaction source code calls generateSeal","duration":0.32789999999999964,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-018 — Non-Org tables cannot be accessed via ScopedDb"],"fullName":"RED-TEAM-018 — Non-Org tables cannot be accessed via ScopedDb ScopedDb throws when table has no org_id column","status":"passed","title":"ScopedDb throws when table has no org_id column","duration":0.3077000000000112,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-018 — Non-Org tables cannot be accessed via ScopedDb"],"fullName":"RED-TEAM-018 — Non-Org tables cannot be accessed via ScopedDb org-registry documents all non-Org tables with reasons","status":"passed","title":"org-registry documents all non-Org tables with reasons","duration":0.36070000000000846,"failureMessages":[],"meta":{}},{"ancestorTitles":["RED-TEAM-018 — Non-Org tables cannot be accessed via ScopedDb"],"fullName":"RED-TEAM-018 — Non-Org tables cannot be accessed via ScopedDb every table is classified as Org-scoped or non-Org-scoped","status":"passed","title":"every table is classified as Org-scoped or non-Org-scoped","duration":0.33899999999999864,"failureMessages":[],"meta":{}}],"startTime":1772295415822,"endTime":1772295415896.3606,"status":"passed","message":"","name":"C:/APPS/nzila-automation/security/redteam/breach-harness-extended.test.ts"}]}